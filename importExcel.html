<html lang="en">

<head>
  <title> Import EXcel Sheet into HTML structure using jQuery </title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1,  
        shrink-to-fit = no">
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js"> </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.js"> </script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js">
  </script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js">
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js">
  </script>
<style>
  /* body {
  margin: 20px 60px;
} */

.drop-container {
  position: relative;
  display: flex;
  gap: 10px;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 200px;
  padding: 20px;
  border-radius: 10px;
  border: 2px dashed #555;
  color: #444;
  cursor: pointer;
  transition: background .2s ease-in-out, border .2s ease-in-out;
}

.drop-container:hover,
.drop-container.drag-active {
  background: #eee;
  border-color: #111;
}

.drop-container:hover .drop-title,
.drop-container.drag-active .drop-title {
  color: #222;
}

.drop-title {
  color: #444;
  font-size: 20px;
  font-weight: bold;
  text-align: center;
  transition: color .2s ease-in-out;
}

input[type=file] {
  width: 350px;
  max-width: 100%;
  color: #444;
  padding: 5px;
  background: #fff;
  border-radius: 10px;
  border: 1px solid #555;
}

input[type=file]::file-selector-button {
  margin-right: 20px;
  border: none;
  background: #084cdf;
  padding: 10px 20px;
  border-radius: 10px;
  color: #fff;
  cursor: pointer;
  transition: background .2s ease-in-out;
}

input[type=file]::file-selector-button:hover {
  background: #0d45a5;
}
</style>
<body style='padding: 25px;'>


  <!-- <form enctype="multipart/form-data">
    <input id="InputfileExcel" type=file name="files[]">
  </form> -->

  <label for="InputfileExcel" class="drop-container" id="dropcontainer">
    <span class="drop-title">Drop files here</span>
    or
    <!-- <form enctype="multipart/form-data"> -->
      <input id="InputfileExcel" type=file name="files[]">
    <!-- </form> -->
  </label>


  <table class="table table-bordered" id="myTable">
    <thead>
      <tr>
        <!-- add by js fn addColumnsToTableHeader -->
      </tr>

    </thead>
    <tbody id="myTableBody">
      <!-- add by js fn addRowsAndCellsToTable -->
    </tbody>
  </table>


  <script>
    // Test Excel ----------------------------------------------------------------------------------------------

  



    function AddColumnsToTable(listExcelinput) {
      var dataColumns = [
        { Title: '', Firstname: '', Lastname: '', Nationlity: '', CitizenID: '', Email: '', MobilePhone: '', LineID: '', InsuranceCompany: '' }
      ];

      if (getObjectLength(listExcelinput[0]) != getObjectLength(dataColumns[0])) {
        console.log("Row Error");
      } else {
  
        if (KeysNameMatchColumnsObj(listExcelinput[0], dataColumns[0])) {
          var tableHeader = document.querySelector('#myTable thead tr');
          AddRowsToTable(listExcelinput);
          for (var keyColumns in dataColumns[0]) {
            // console.log('key: ', keyColumns)
            if (dataColumns[0].hasOwnProperty(keyColumns)) {
              var th = document.createElement('th');
              th.innerHTML = keyColumns;
              tableHeader.appendChild(th);
            }
          }
        }else{
          
        }

      }
    }

    function AddRowsToTable(listExcelinput) {
      var tableBody = document.getElementById('myTableBody');
      // console.log("icountRow : ", icountRow);
      for (var i = 0; i < listExcelinput.length; i++) {
        var row = document.createElement('tr');
        for (var key in listExcelinput[i]) {
          // console.log(key);
          if (listExcelinput[i].hasOwnProperty(key)) {
            var cell = document.createElement('td');
            cell.innerHTML = listExcelinput[i][key];
            cell.className = 'myTableCell';
            row.appendChild(cell);
          }
        }
        tableBody.appendChild(row);
      }
    }

    function KeysNameMatchColumnsObj(obj1, obj2) {


      const obj1_sort = Object.keys(obj1).sort();
      const obj2_sort = Object.keys(obj2).sort();
        
      var obj1_sort_upper = ConvertWordsUppercase(obj1_sort);
      var obj2_sort_upper = ConvertWordsUppercase(obj2_sort);
      var obj1_sort_upper_Spaces = ReplaceSpacesWords(obj1_sort_upper);
      var obj2_sort_upper_Spaces = ReplaceSpacesWords(obj2_sort_upper);

      // console.log("Check1 :",obj1_sort_upper_Spaces);
      // console.log("Check2 :",obj2_sort_upper_Spaces);

      for (let A = 0; A < Object.keys(obj1_sort_upper_Spaces).length; A++) {
          if (obj1_sort_upper_Spaces[A] != obj2_sort_upper_Spaces[A]) {
            console.log("Format Col Error :: ",obj1_sort_upper_Spaces[A] +" != " + obj2_sort_upper_Spaces[A]);
            return false; 
          }     
      }

      return true; 
    }

    function ConvertWordsUppercase(obj) {
        var result = {};
        Object.keys(obj).forEach(function(key) {  
            result[key] = typeof obj[key] === 'string' ? obj[key].toUpperCase() : obj[key];
        });
        return result;
    }

    function ReplaceSpacesWords(array) {
      var result = {};
      Object.keys(array).forEach(function(key) {
            result[key] = typeof array[key] === 'string' ? array[key].replace(/ /g, '') : array[key];
        });
      return result;
    }

    function findObjectByKey(key, value) {
      return data.find(function (obj) {
        return obj[key] === value;
      });
    }

    const getObjectLength = (ObjectValue) => {
      objectLength = Object.keys(ObjectValue).length;
      return objectLength;
    }


    var ExcelToJSON = function () {

      this.parseExcel = function (file) {
        // console.log("file :", file);
        var reader = new FileReader();

        reader.onload = function (e) {

          var data = e.target.result;
          var workbook = XLSX.read(data, {
            type: "binary",
          });


          workbook.SheetNames.forEach(function (sheetName) {
            // console.log("sheetName:", sheetName);
            var XL_row_object = XLSX.utils.sheet_to_row_object_array(
              workbook.Sheets[sheetName]
            );

            var json_object = JSON.stringify(XL_row_object);
            productList = JSON.parse(json_object);
            var rows = $(".table tbody tr");
             console.log("JSON: ", productList);

            AddColumnsToTable(productList);


          });

        };
        reader.onerror = function (ex) {
          console.log(ex);
        };
        reader.readAsBinaryString(file);
      };
    };

    function handleFileSelect(evt) {

      var files = evt.target.files;
      // console.log("files ::", files);
      var xl2json = new ExcelToJSON();
      // console.log("xl2json ::", xl2json);
      xl2json.parseExcel(files[0]);

    }
    


    const dropContainer = document.getElementById("dropcontainer");
    const elementInputfileExcel = document.getElementById("InputfileExcel");
    dropContainer.addEventListener("dragover", (e) => {
      e.preventDefault()
    }, false)

    dropContainer.addEventListener("dragenter", () => {
      dropContainer.classList.add("drag-active")
    })

    dropContainer.addEventListener("dragleave", () => {
      dropContainer.classList.remove("drag-active")
    })

    dropContainer.addEventListener("drop", (e) => {
      e.preventDefault();
      dropContainer.classList.remove("drag-active");
      elementInputfileExcel.files = e.dataTransfer.files;
    })
    if (elementInputfileExcel) {
      console.log("open table");
      elementInputfileExcel.addEventListener("change", handleFileSelect, false);
    } else {
      console.log("not open table");
    }

    // Test Excel ----------------------------------------------------------------------------------------------
  </script>

</body>

</html>